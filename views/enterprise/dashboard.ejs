<%- include('../partials/head') %>

<%- include('../partials/sidebar_enterprise') %>
<div class="sidebar-overlay" onclick="closeSidebar()"></div>

<div class="app-layout">
  <div class="main-content">
    <div class="mobile-header">
      <button class="hamburger-btn" onclick="toggleSidebar()">
        <span class="material-icons-round">menu</span>
      </button>
      <div class="logo-area">
        <span style="font-size:24px">üçµ</span>
        <span class="font-bold">Enterprise</span>
      </div>
      <button class="theme-pill" onclick="toggleTheme()">
        <span class="theme-icon">‚òÄÔ∏è</span>
      </button>
    </div>

    <%- include('../partials/topbar', { shell: 'enterprise' }) %>

    <div class="page-content">
      <!-- Welcome Banner -->
      <div class="welcome-banner mb-4" style="background:linear-gradient(135deg,#A855F7 0%,#7C3AED 100%);">
        <div>
          <h1 style="font-size:28px;margin-bottom:8px;">Welcome, <%= user.name || 'Enterprise' %></h1>
          <p style="opacity:.85;">Discover and connect with top talent across universities</p>
        </div>
        <div style="font-size:48px;">üè¢</div>
      </div>

      <!-- Stats -->
      <div class="stats-grid mb-4">
        <div class="stat-card">
          <div class="stat-number"><%= studentCount %></div>
          <div class="stat-label">Total Students</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= matches.length %></div>
          <div class="stat-label">Your Matches</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= posts.length %></div>
          <div class="stat-label">Your Posts</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= events.length %></div>
          <div class="stat-label">Events</div>
        </div>
      </div>

      <div class="grid grid-2 mb-4">
        <!-- Recent Matches -->
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <h3>
              <span class="material-icons-round" style="vertical-align:middle;margin-right:8px;font-size:20px;">people_alt</span>
              Recent Matches
            </h3>
            <a href="/enterprise/candidates" class="btn btn-outline btn-sm">View All</a>
          </div>

          <% if (matches.length > 0) { %>
            <% matches.slice(0, 5).forEach(match => { %>
              <div style="padding:12px 0;border-bottom:1px solid var(--border);">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <div class="flex items-center gap-2">
                    <div class="avatar" style="width:32px;height:32px;font-size:11px;background:#A855F720;color:#A855F7;">
                      <%= (match.candidate_id || 'C').charAt(0).toUpperCase() %>
                    </div>
                    <div>
                      <div class="font-semibold text-sm"><%= match.match_type || 'Candidate' %></div>
                      <div class="text-xs text-secondary"><%= match.reason || '' %></div>
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="font-semibold" style="color:#A855F7;"><%= match.score || 0 %>%</div>
                    <div class="text-xs text-secondary" style="text-transform:capitalize;"><%= match.match_status || 'pending' %></div>
                  </div>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <div class="text-secondary text-center" style="padding:24px;">
              No matches yet. <a href="/enterprise/candidates">Search for candidates</a>.
            </div>
          <% } %>
        </div>

        <!-- Posts / Job Listings -->
        <div class="card">
          <h3 class="mb-3">
            <span class="material-icons-round" style="vertical-align:middle;margin-right:8px;font-size:20px;">work</span>
            Your Posts
          </h3>

          <% if (posts.length > 0) { %>
            <% posts.slice(0, 5).forEach(post => { %>
              <div style="padding:12px 0;border-bottom:1px solid var(--border);">
                <div class="font-semibold text-sm"><%= post.title || post.post_title || 'Post' %></div>
                <div class="text-xs text-secondary mt-1"><%= post.description || '' %></div>
                <% if (post.requirements && post.requirements.length > 0) { %>
                  <div class="flex gap-1 mt-2" style="flex-wrap:wrap;">
                    <span class="chip" style="font-size:10px;padding:2px 8px;"><%= post.requirements.length %> requirement(s)</span>
                  </div>
                <% } %>
              </div>
            <% }); %>
          <% } else { %>
            <div class="text-secondary text-center" style="padding:24px;">No posts created yet.</div>
          <% } %>
        </div>
      </div>

      <!-- Upcoming Events -->
      <div class="card">
        <h3 class="mb-3">
          <span class="material-icons-round" style="vertical-align:middle;margin-right:8px;font-size:20px;">event</span>
          Upcoming Events
        </h3>
        <% if (events.length > 0) { %>
          <div class="grid grid-3">
            <% events.slice(0, 6).forEach(event => { %>
              <div class="event-card">
                <div class="font-semibold mb-1"><%= event.event_title %></div>
                <div class="text-xs text-secondary">
                  <span class="material-icons-round" style="font-size:14px;vertical-align:middle;">calendar_today</span>
                  <%= event.date || 'TBA' %>
                </div>
                <div class="text-xs text-secondary mt-1">
                  <span class="material-icons-round" style="font-size:14px;vertical-align:middle;">location_on</span>
                  <%= event.location || 'TBA' %>
                </div>
                <div class="flex gap-1 mt-2">
                  <% if (event.is_official) { %>
                    <span class="chip chip-primary" style="font-size:10px;padding:2px 8px;">Official</span>
                  <% } %>
                  <% if (event.is_all_majors) { %>
                    <span class="chip chip-secondary" style="font-size:10px;padding:2px 8px;">All Majors</span>
                  <% } %>
                </div>
              </div>
            <% }); %>
          </div>
        <% } else { %>
          <div class="text-secondary text-center" style="padding:24px;">No upcoming events.</div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
